<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciar Clientes - NovaModa Admin</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { display: flex; margin: 0; background: #0a0a0a; font-family: 'Inter', sans-serif; }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: #111;
      height: 100vh;
      position: fixed;
      border-right: 1px solid #222;
      padding: 20px;
      overflow-y: auto;
    }

    .sidebar .logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: #14d0d6;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid #222;
    }

    .menu-item {
      padding: 12px 16px;
      margin: 8px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #aaa;
      text-decoration: none;
    }

    .menu-item:hover, .menu-item.active {
      background: rgba(20, 208, 214, 0.1);
      color: #14d0d6;
    }

    /* Main Content */
    .main-content {
      margin-left: 260px;
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      height: 100vh;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
    }

    .header h1 { font-size: 2rem; margin: 0; color: #fff; }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: #111;
      padding: 24px;
      border-radius: 12px;
      border: 1px solid #222;
    }

    .stat-label {
      color: #888;
      font-size: 13px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: #14d0d6;
    }

    /* Filtros */
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      max-width: 400px;
    }

    .search-box input {
      width: 100%;
      padding: 10px 15px;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
    }

    .filter-select {
      padding: 10px 15px;
      background: #111;
      border: 1px solid #333;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    /* Tabela */
    .table-container {
      background: #111;
      border-radius: 12px;
      border: 1px solid #222;
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid #222;
    }

    th {
      background: #0a0a0a;
      color: #888;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 12px;
    }

    td {
      color: #ccc;
    }

    tr:hover {
      background: #0a0a0a;
    }

    .customer-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #14d0d6, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #000;
      font-size: 16px;
    }

    .customer-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .customer-name {
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }

    .customer-email {
      font-size: 13px;
      color: #888;
    }

    /* Badges */
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .badge-vip { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .badge-regular { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .badge-new { background: rgba(74, 222, 128, 0.2); color: #4ade80; }

    /* Bot√µes */
    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 12px;
    }

    .btn-primary {
      background: #14d0d6;
      color: #000;
    }

    .btn-secondary {
      background: #222;
      color: #aaa;
      margin-left: 6px;
    }

    .btn-danger {
      background: rgba(255, 59, 48, 0.2);
      color: #ff3b30;
      margin-left: 6px;
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: #111;
      padding: 40px;
      border-radius: 12px;
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid #222;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #222;
    }

    .modal-header h2 {
      margin: 0;
      color: #fff;
      font-size: 1.5rem;
    }

    .close-modal {
      background: transparent;
      border: none;
      color: #888;
      font-size: 28px;
      cursor: pointer;
    }

    .close-modal:hover {
      color: #ff3b30;
    }

    .modal-section {
      margin-bottom: 30px;
    }

    .modal-section h3 {
      color: #888;
      font-size: 14px;
      text-transform: uppercase;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #222;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #222;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #888;
      font-size: 14px;
    }

    .info-value {
      color: #fff;
      font-weight: 600;
    }

    .orders-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .order-item {
      background: #0a0a0a;
      padding: 12px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    @media(max-width: 968px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; }
      table { font-size: 13px; }
      th, td { padding: 10px; }
      .stats-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">üë• NovaModa Admin</div>
    <a href="admin.html" class="menu-item">
      <span>üìä</span> Dashboard
    </a>
    <a href="admin-pedidos.html" class="menu-item">
      <span>üì¶</span> Pedidos
    </a>
    <a href="admin-produtos.html" class="menu-item">
      <span>üëï</span> Produtos
    </a>
    <a href="admin-clientes.html" class="menu-item active">
      <span>üë•</span> Clientes
    </a>
    <a href="admin-relatorios.html" class="menu-item">
      <span>üìà</span> Relat√≥rios
    </a>
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #222;">
      <a href="index.html" class="menu-item">
        <span>üè†</span> Voltar ao Site
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <h1>Gerenciar Clientes</h1>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total de Clientes</div>
        <div class="stat-value" id="totalClients">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Novos (30 dias)</div>
        <div class="stat-value" id="newClients">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Clientes VIP</div>
        <div class="stat-value" id="vipClients">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Taxa de Recompra</div>
        <div class="stat-value" id="repeatRate">0%</div>
      </div>
    </div>

    <!-- Filtros -->
    <div class="filters">
      <div class="search-box">
        <input type="text" id="searchClients" placeholder="Buscar por nome ou email...">
      </div>
      
      <select class="filter-select" id="typeFilter">
        <option value="">Todos os Tipos</option>
        <option value="vip">VIP</option>
        <option value="regular">Regular</option>
        <option value="new">Novo</option>
      </select>

      <select class="filter-select" id="sortFilter">
        <option value="name">Nome A-Z</option>
        <option value="orders">Mais Pedidos</option>
        <option value="spent">Maior Gasto</option>
        <option value="recent">Mais Recente</option>
      </select>
    </div>

    <!-- Tabela -->
    <div class="table-container">
      <table id="clientsTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Cliente</th>
      <th>Telefone</th>
      <th>Pedidos</th>
      <th>Total Gasto</th>
      <th>Cadastro</th>
    </tr>
  </thead>
  <tbody>
    <!-- Clientes ser√£o carregados aqui -->
  </tbody>
</table>
    </div>
  </div>

  <!-- Modal Detalhes -->
  <div class="modal" id="clientModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalClientName">Detalhes do Cliente</h2>
        <button class="close-modal" onclick="closeModal()">√ó</button>
      </div>

      <!-- Informa√ß√µes Pessoais -->
      <div class="modal-section">
        <h3>Informa√ß√µes Pessoais</h3>
        <div class="info-row">
          <span class="info-label">Nome Completo</span>
          <span class="info-value" id="clientFullName"></span>
        </div>
        <div class="info-row">
          <span class="info-label">Email</span>
          <span class="info-value" id="clientEmail"></span>
        </div>
        <div class="info-row">
          <span class="info-label">Telefone</span>
          <span class="info-value" id="clientPhone"></span>
        </div>
        <div class="info-row">
          <span class="info-label">CPF</span>
          <span class="info-value" id="clientCPF"></span>
        </div>
        <div class="info-row">
          <span class="info-label">Cadastro</span>
          <span class="info-value" id="clientJoinDate"></span>
        </div>
      </div>

      <!-- Estat√≠sticas -->
      <div class="modal-section">
        <h3>Estat√≠sticas de Compra</h3>
        <div class="info-row">
          <span class="info-label">Total de Pedidos</span>
          <span class="info-value" id="clientOrders"></span>
        </div>
        <div class="info-row">
          <span class="info-label">Total Gasto</span>
          <span class="info-value" style="color:#14d0d6;" id="clientSpent"></span>
        </div>
        <div class="info-row">
          <span class="info-label">Ticket M√©dio</span>
          <span class="info-value" id="clientAverage"></span>
        </div>
        <div class="info-row">
          <span class="info-label">√öltimo Pedido</span>
          <span class="info-value" id="clientLastOrder"></span>
        </div>
      </div>

      <!-- Hist√≥rico de Pedidos -->
      <div class="modal-section">
        <h3>Hist√≥rico de Pedidos</h3>
        <div class="orders-list" id="clientOrdersList">
          <!-- Pedidos do cliente -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Gerar clientes a partir dos pedidos
    let clients = [];
    
    function generateClients() {
      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      const users = JSON.parse(localStorage.getItem('novamoda_users') || '[]');
      const clientsMap = new Map();

      // Processar pedidos
      orders.forEach(order => {
        const email = order.customer.email;
        
        if (!clientsMap.has(email)) {
          clientsMap.set(email, {
            id: Date.now() + Math.random(),
            name: order.customer.fullName,
            email: order.customer.email,
            phone: order.customer.phone || 'N√£o informado',
            cpf: order.customer.cpf || 'N√£o informado',
            joinDate: order.date,
            orders: [],
            totalSpent: 0
          });
        }

        const client = clientsMap.get(email);
        client.orders.push({
          number: order.number,
          date: order.date,
          total: order.total,
          status: order.status
        });
        client.totalSpent += order.total;
      });

      // Adicionar usu√°rios cadastrados que n√£o fizeram pedidos
      users.forEach(user => {
        if (!clientsMap.has(user.email)) {
          clientsMap.set(user.email, {
            id: user.id,
            name: user.name,
            email: user.email,
            phone: 'N√£o informado',
            cpf: 'N√£o informado',
            joinDate: new Date().toISOString(),
            orders: [],
            totalSpent: 0
          });
        }
      });

      clients = Array.from(clientsMap.values());
      
      // Adicionar clientes fake se n√£o existirem
      if (clients.length === 0) {
        clients = [
          {
            id: 1,
            name: 'Jo√£o Silva',
            email: 'joao@email.com',
            phone: '(11) 98765-4321',
            cpf: '123.456.789-00',
            joinDate: new Date(Date.now() - 180*24*60*60*1000).toISOString(),
            orders: [
              { number: '#10234', date: new Date().toISOString(), total: 339.70, status: 'delivered' },
              { number: '#10120', date: new Date(Date.now() - 30*24*60*60*1000).toISOString(), total: 459.80, status: 'delivered' }
            ],
            totalSpent: 799.50
          },
          {
            id: 2,
            name: 'Maria Santos',
            email: 'maria@email.com',
            phone: '(11) 91234-5678',
            cpf: '987.654.321-00',
            joinDate: new Date(Date.now() - 90*24*60*60*1000).toISOString(),
            orders: [
              { number: '#10233', date: new Date(Date.now() - 1*24*60*60*1000).toISOString(), total: 249.90, status: 'shipped' }
            ],
            totalSpent: 249.90
          },
          {
            id: 3,
            name: 'Carlos Oliveira',
            email: 'carlos@email.com',
            phone: '(21) 99876-5432',
            cpf: '456.789.123-00',
            joinDate: new Date(Date.now() - 15*24*60*60*1000).toISOString(),
            orders: [],
            totalSpent: 0
          }
        ];
      }

      return clients;
    }

    clients = generateClients();

    // Classificar cliente
    function getClientType(client) {
      if (client.totalSpent >= 1000) return 'vip';
      if (client.orders.length === 0) return 'new';
      return 'regular';
    }

    function getClientTypeLabel(type) {
      const labels = {
        vip: 'VIP',
        regular: 'Regular',
        new: 'Novo'
      };
      return labels[type];
    }

    // Renderizar clientes
    function renderClients() {
      const table = document.getElementById('clientsTable');
      let filtered = [...clients];

      // Busca
      const search = document.getElementById('searchClients').value.toLowerCase();
      if (search) {
        filtered = filtered.filter(c => 
          c.name.toLowerCase().includes(search) || 
          c.email.toLowerCase().includes(search)
        );
      }

      // Filtro de tipo
      const type = document.getElementById('typeFilter').value;
      if (type) {
        filtered = filtered.filter(c => getClientType(c) === type);
      }

      // Ordena√ß√£o
      const sort = document.getElementById('sortFilter').value;
      if (sort === 'name') {
        filtered.sort((a, b) => a.name.localeCompare(b.name));
      } else if (sort === 'orders') {
        filtered.sort((a, b) => b.orders.length - a.orders.length);
      } else if (sort === 'spent') {
        filtered.sort((a, b) => b.totalSpent - a.totalSpent);
      } else if (sort === 'recent') {
        filtered.sort((a, b) => new Date(b.joinDate) - new Date(a.joinDate));
      }

      table.innerHTML = filtered.map(client => {
        const type = getClientType(client);
        const initials = client.name.split(' ').map(n => n[0]).join('').substring(0, 2);
        const lastOrder = client.orders.length > 0 ? 
          new Date(client.orders[client.orders.length - 1].date).toLocaleDateString('pt-BR') : 
          'Nunca';

        return `
          <tr>
            <td>
              <div class="customer-info">
                <div class="customer-avatar">${initials}</div>
                <div>
                  <div class="customer-name">${client.name}</div>
                  <div class="customer-email">${client.email}</div>
                </div>
              </div>
            </td>
            <td><span class="badge badge-${type}">${getClientTypeLabel(type)}</span></td>
            <td>${client.orders.length}</td>
            <td><strong>R$ ${client.totalSpent.toFixed(2).replace('.', ',')}</strong></td>
            <td>${lastOrder}</td>
            <td>
              <button class="btn btn-primary" onclick="viewClient(${client.id})">Ver Detalhes</button>
              <button class="btn btn-secondary" onclick="alert('Enviar email para ${client.email}')">Email</button>
              <button class="btn btn-danger" onclick="deleteClient(${client.id})">Excluir</button>
            </td>
          </tr>
        `;
      }).join('');

      updateStats();
    }

    // Atualizar estat√≠sticas
    function updateStats() {
      document.getElementById('totalClients').textContent = clients.length;
      
      const thirtyDaysAgo = Date.now() - 30*24*60*60*1000;
      const newClients = clients.filter(c => new Date(c.joinDate) > thirtyDaysAgo).length;
      document.getElementById('newClients').textContent = newClients;
      
      const vipClients = clients.filter(c => getClientType(c) === 'vip').length;
      document.getElementById('vipClients').textContent = vipClients;
      
      const repeatClients = clients.filter(c => c.orders.length > 1).length;
      const repeatRate = clients.length > 0 ? ((repeatClients / clients.length) * 100).toFixed(0) : 0;
      document.getElementById('repeatRate').textContent = repeatRate + '%';
    }

    // Ver detalhes do cliente
    function viewClient(id) {
      const client = clients.find(c => c.id === id);
      if (!client) return;

      document.getElementById('modalClientName').textContent = client.name;
      document.getElementById('clientFullName').textContent = client.name;
      document.getElementById('clientEmail').textContent = client.email;
      document.getElementById('clientPhone').textContent = client.phone;
      document.getElementById('clientCPF').textContent = client.cpf;
      document.getElementById('clientJoinDate').textContent = new Date(client.joinDate).toLocaleDateString('pt-BR');
      
      document.getElementById('clientOrders').textContent = client.orders.length;
      document.getElementById('clientSpent').textContent = 'R$ ' + client.totalSpent.toFixed(2).replace('.', ',');
      
      const average = client.orders.length > 0 ? client.totalSpent / client.orders.length : 0;
      document.getElementById('clientAverage').textContent = 'R$ ' + average.toFixed(2).replace('.', ',');
      
      const lastOrder = client.orders.length > 0 ? 
        new Date(client.orders[client.orders.length - 1].date).toLocaleDateString('pt-BR') : 
        'Nunca';
      document.getElementById('clientLastOrder').textContent = lastOrder;

      // Lista de pedidos
      const ordersList = document.getElementById('clientOrdersList');
      if (client.orders.length === 0) {
        ordersList.innerHTML = '<p style="color:#888;text-align:center;padding:20px;">Nenhum pedido realizado</p>';
      } else {
        ordersList.innerHTML = client.orders.map(order => `
          <div class="order-item">
            <div>
              <strong>${order.number}</strong>
              <div style="font-size:12px;color:#888;margin-top:4px;">
                ${new Date(order.date).toLocaleDateString('pt-BR')}
              </div>
            </div>
            <div style="text-align:right;">
              <strong style="color:#14d0d6;">R$ ${order.total.toFixed(2).replace('.', ',')}</strong>
            </div>
          </div>
        `).join('');
      }

      document.getElementById('clientModal').classList.add('show');
    }

    // Excluir cliente
    function deleteClient(id) {
      if (!confirm('Tem certeza que deseja excluir este cliente?')) return;
      
      clients = clients.filter(c => c.id !== id);
      renderClients();
      alert('Cliente exclu√≠do com sucesso!');
    }

    // Fechar modal
    function closeModal() {
      document.getElementById('clientModal').classList.remove('show');
    }

    // Event listeners
    document.getElementById('searchClients').addEventListener('input', renderClients);
    document.getElementById('typeFilter').addEventListener('change', renderClients);
    document.getElementById('sortFilter').addEventListener('change', renderClients);

    // Inicializar
    renderClients();
  </script>
  <script src="js/admin.js"></script> 
</body>
</html>