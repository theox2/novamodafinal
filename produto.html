<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produto - NovaModa</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: #0b0b0b;
      color: #fff;
      padding-top: 80px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .product-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      margin-top: 40px;
    }

    /* Galeria */
    .gallery {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .main-img {
      width: 100%;
      height: 500px;
      border-radius: 12px;
      overflow: hidden;
      background: #111;
    }

    .main-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }

    .main-img:hover img {
      transform: scale(1.05);
    }

    .thumbs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .thumb {
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
    }

    .thumb:hover { border-color: #14d0d6; }
    .thumb.active { border-color: #14d0d6; }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Info */
    .product-info {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .badge {
      background: #14d0d6;
      color: #000;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      width: fit-content;
      text-transform: uppercase;
    }

    h1 {
      font-size: 2.5rem;
      line-height: 1.2;
    }

    .rating {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fbbf24;
    }

    .price {
      font-size: 2.5rem;
      color: #14d0d6;
      font-weight: 800;
    }

    .old-price {
      font-size: 1.2rem;
      color: #666;
      text-decoration: line-through;
      margin-left: 15px;
    }

    .description {
      color: #aaa;
      line-height: 1.6;
    }

    /* OpÃ§Ãµes */
    .option-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option-label {
      font-size: 14px;
      color: #888;
      text-transform: uppercase;
      font-weight: 600;
    }

    .options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .option-btn {
      padding: 12px 20px;
      background: #111;
      border: 2px solid #333;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .option-btn:hover {
      border-color: #666;
    }

    .option-btn.active {
      border-color: #14d0d6;
      background: rgba(20, 208, 214, 0.1);
      color: #14d0d6;
    }

    /* Quantidade */
    .qty-section {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .qty-control {
      display: flex;
      align-items: center;
      gap: 15px;
      background: #111;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #333;
    }

    .qty-btn {
      background: transparent;
      border: none;
      color: #14d0d6;
      font-size: 22px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .qty-btn:hover {
      transform: scale(1.2);
    }

    .qty-value {
      font-size: 18px;
      font-weight: 700;
      min-width: 40px;
      text-align: center;
    }

    /* BotÃµes */
    .actions {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }

    .btn {
      flex: 1;
      padding: 18px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
    }

    .btn-primary {
      background: #14d0d6;
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(20, 208, 214, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #fff;
      color: #000;
    }

    .btn-secondary:hover {
      background: #f0f0f0;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #14d0d6;
      color: #000;
      padding: 16px 24px;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      z-index: 9999;
      transform: translateX(400px);
      transition: transform 0.3s;
    }

    .toast.show {
      transform: translateX(0);
    }

    /* Responsive */
    @media (max-width: 968px) {
      .product-grid {
        grid-template-columns: 1fr;
        gap: 40px;
      }

      h1 { font-size: 1.8rem; }
      .price { font-size: 2rem; }
      .actions { flex-direction: column; }
    }
  </style>
</head>
<body>
  <!-- LOADER -->
  <div id="loader">
    <div class="spinner"></div>
  </div>

  <!-- HEADER -->
  <header class="header">
    <div class="header-container">
      <div class="logo-area" onclick="location.href='index.html'">
        <img src="Yellow_Black_Brush_Streetwear_Brand_Logo-removebg-preview.png" class="logo" alt="NovaModa">
        <span class="brand">NovaModa</span>
      </div>
      
      <div class="right-area">
        <a class="btn entrar-btn" href="login.html">Entrar</a>
        <div class="icons">
          <span class="icon" onclick="location.href='favoritos.html'">â™¥</span>
          <span class="icon" onclick="location.href='carrinho.html'">ðŸ›’<span class="cart-count">0</span></span>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="product-grid">
      <!-- Galeria -->
      <div class="gallery">
        <div class="main-img">
          <img id="mainImage" src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800" alt="Produto">
        </div>
        <div class="thumbs" id="thumbsContainer">
          <!-- Miniaturas inseridas via JS -->
        </div>
      </div>

      <!-- Info -->
      <div class="product-info">
        <span class="badge" id="productBadge">NOVO</span>
        
        <h1 id="productName">Produto</h1>
        
        <div class="rating" id="productRating">
          <span>â˜…â˜…â˜…â˜…â˜…</span>
          <span style="color: #888;">(0 avaliaÃ§Ãµes)</span>
        </div>

        <div>
          <span class="price" id="productPrice">R$ 0,00</span>
          <span class="old-price" id="productOldPrice">R$ 0,00</span>
        </div>

        <p class="description" id="productDescription">
          DescriÃ§Ã£o do produto
        </p>

        <!-- Tamanho -->
        <div class="option-group">
          <div class="option-label">Tamanho</div>
          <div class="options" id="sizeOptions">
            <button class="option-btn active" onclick="selectOption(this, 'size')">M</button>
          </div>
        </div>

        <!-- Cor -->
        <div class="option-group">
          <div class="option-label">Cor</div>
          <div class="options" id="colorOptions">
            <button class="option-btn active" onclick="selectOption(this, 'color')">Preto</button>
          </div>
        </div>

        <!-- Quantidade -->
        <div class="qty-section">
          <div class="option-label">Quantidade</div>
          <div class="qty-control">
            <button class="qty-btn" onclick="updateQty(-1)">âˆ’</button>
            <span class="qty-value" id="qty">1</span>
            <button class="qty-btn" onclick="updateQty(1)">+</button>
          </div>
          <span id="stockStatus" style="color: #4ade80; font-size: 14px;">âœ“ Em estoque</span>
        </div>

        <!-- BotÃµes -->
        <div class="actions">
          <button class="btn btn-primary" id="addToCartBtn" onclick="addToCart()">
            ðŸ›’ Adicionar ao Carrinho
          </button>
          <button class="btn btn-secondary" onclick="buyNow()">
            Comprar Agora
          </button>
        </div>
      </div>
    </div>

    <!-- SeÃ§Ã£o de AvaliaÃ§Ãµes -->
    <div id="reviewsContainer" style="margin-top: 80px;">
      <!-- As avaliaÃ§Ãµes serÃ£o renderizadas aqui pelo reviews.js -->
    </div>

  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- SCRIPTS -->
  <script src="js/storage.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/animations.js"></script>
  <script src="js/app.js"></script>
  <script src="js/reviews.js"></script>

  <script>
    // ==========================================
    // BASE DE DADOS DE PRODUTOS
    // ==========================================
    const produtosDB = {
      1: {
        id: 1,
        name: 'Camiseta Oversized Street',
        price: 129.90,
        oldPrice: 179.90,
        images: [
          'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',
          'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800',
          'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800',
          'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800'
        ],
        description: 'Camiseta oversized premium com tecido 100% algodÃ£o. Design moderno e confortÃ¡vel, perfeita para o streetwear urbano. DisponÃ­vel em vÃ¡rias cores e tamanhos.',
        badge: 'NOVO',
        rating: 4.8,
        reviews: 248,
        stock: 45,
        sizes: ['P', 'M', 'G', 'GG'],
        colors: ['Preto', 'Branco', 'Cinza']
      },
      2: {
        id: 2,
        name: 'Moletom Premium Black',
        price: 249.90,
        oldPrice: null,
        images: [
          'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800',
          'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',
          'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800',
          'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800'
        ],
        description: 'Moletom premium com capuz e bolso canguru. Tecido macio e quente, perfeito para os dias frios.',
        badge: null,
        rating: 4.9,
        reviews: 312,
        stock: 23,
        sizes: ['P', 'M', 'G', 'GG'],
        colors: ['Preto', 'Cinza', 'Azul Marinho']
      },
      3: {
        id: 3,
        name: 'CalÃ§a Cargo Utility',
        price: 189.90,
        oldPrice: null,
        images: [
          'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800',
          'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',
          'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800',
          'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800'
        ],
        description: 'CalÃ§a cargo com mÃºltiplos bolsos funcionais. Design utilitÃ¡rio moderno.',
        badge: null,
        rating: 4.6,
        reviews: 189,
        stock: 8,
        sizes: ['38', '40', '42', '44', '46'],
        colors: ['Verde Militar', 'Preto', 'Bege']
      },
      4: {
        id: 4,
        name: 'Jaqueta Bomber Vintage',
        price: 299.90,
        oldPrice: 399.90,
        images: [
          'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800',
          'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',
          'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800',
          'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800'
        ],
        description: 'Jaqueta bomber estilo vintage com acabamento premium.',
        badge: 'SALE',
        rating: 4.7,
        reviews: 156,
        stock: 0,
        sizes: ['P', 'M', 'G', 'GG'],
        colors: ['Preto', 'Verde Oliva', 'Azul Marinho']
      },
      5: {
        id: 5,
        name: 'TÃªnis Air Classic',
        price: 599.90,
        oldPrice: null,
        images: [
          'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800',
          'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',
          'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800',
          'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800'
        ],
        description: 'TÃªnis esportivo clÃ¡ssico com tecnologia de amortecimento Air.',
        badge: null,
        rating: 5.0,
        reviews: 428,
        stock: 67,
        sizes: ['38', '39', '40', '41', '42', '43', '44'],
        colors: ['Branco', 'Preto', 'Preto/Branco']
      },
      6: {
        id: 6,
        name: 'BonÃ© Snapback Logo',
        price: 79.90,
        oldPrice: null,
        images: [
          'https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=800',
          'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',
          'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800',
          'https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800'
        ],
        description: 'BonÃ© snapback com logo bordado. Ajuste regulÃ¡vel e tecido respirÃ¡vel.',
        badge: null,
        rating: 4.5,
        reviews: 89,
        stock: 120,
        sizes: ['Ãšnico'],
        colors: ['Preto', 'Branco', 'Azul', 'Vermelho']
      }
    };

    let qty = 1;
    let currentProduct = null;

    // ==========================================
    // CARREGAR PRODUTO
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = parseInt(urlParams.get('id')) || 1;

      currentProduct = produtosDB[productId];

      if (!currentProduct) {
        alert('Produto nÃ£o encontrado!');
        window.location.href = 'categorias.html';
        return;
      }

      loadProduct(currentProduct);
      
      // Atualizar contador do carrinho
      if (typeof storage !== 'undefined' && storage.updateCartCount) {
        storage.updateCartCount();
      }
    });

    function loadProduct(produto) {
      // Nome e badge
      document.getElementById('productName').textContent = produto.name;
      document.title = `${produto.name} - NovaModa`;
      
      const badgeEl = document.getElementById('productBadge');
      if (produto.badge) {
        badgeEl.textContent = produto.badge;
        badgeEl.style.display = 'inline-block';
      } else {
        badgeEl.style.display = 'none';
      }

      // PreÃ§o
      document.getElementById('productPrice').textContent = `R$ ${produto.price.toFixed(2).replace('.', ',')}`;
      
      const oldPriceEl = document.getElementById('productOldPrice');
      if (produto.oldPrice) {
        oldPriceEl.textContent = `R$ ${produto.oldPrice.toFixed(2).replace('.', ',')}`;
        oldPriceEl.style.display = 'inline';
      } else {
        oldPriceEl.style.display = 'none';
      }

      // AvaliaÃ§Ãµes
      document.getElementById('productRating').innerHTML = `
        <span>${'â˜…'.repeat(Math.floor(produto.rating))}${'â˜†'.repeat(5-Math.floor(produto.rating))}</span>
        <span style="color: #888;">(${produto.reviews} avaliaÃ§Ãµes)</span>
      `;

      // DescriÃ§Ã£o
      document.getElementById('productDescription').textContent = produto.description;

      // Estoque
      const stockEl = document.getElementById('stockStatus');
      const addBtn = document.getElementById('addToCartBtn');
      
      if (produto.stock === 0) {
        stockEl.innerHTML = 'âœ— Esgotado';
        stockEl.style.color = '#ff3b30';
        addBtn.disabled = true;
        addBtn.textContent = 'Produto Esgotado';
      } else if (produto.stock <= 10) {
        stockEl.innerHTML = `âš ï¸ Ãšltimas ${produto.stock} unidades`;
        stockEl.style.color = '#fbbf24';
      } else {
        stockEl.innerHTML = 'âœ“ Em estoque';
        stockEl.style.color = '#4ade80';
      }

      // Galeria
      document.getElementById('mainImage').src = produto.images[0];
      
      const thumbsContainer = document.getElementById('thumbsContainer');
      thumbsContainer.innerHTML = produto.images.map((img, index) => `
        <div class="thumb ${index === 0 ? 'active' : ''}" onclick="changeImage(this, '${img}')">
          <img src="${img}" alt="Thumb ${index + 1}">
        </div>
      `).join('');

      // Tamanhos
      const sizesContainer = document.getElementById('sizeOptions');
      sizesContainer.innerHTML = produto.sizes.map((size, i) => `
        <button class="option-btn ${i === 1 ? 'active' : ''}" onclick="selectOption(this, 'size')">${size}</button>
      `).join('');

      // Cores
      const colorsContainer = document.getElementById('colorOptions');
      colorsContainer.innerHTML = produto.colors.map((color, i) => `
        <button class="option-btn ${i === 0 ? 'active' : ''}" onclick="selectOption(this, 'color')">${color}</button>
      `).join('');
    }

    // ==========================================
    // FUNÃ‡Ã•ES DE INTERAÃ‡ÃƒO
    // ==========================================
    function changeImage(thumb, src) {
      document.getElementById('mainImage').src = src;
      document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
      thumb.classList.add('active');
    }

    function selectOption(btn, type) {
      const parent = btn.parentElement;
      parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    function updateQty(delta) {
      qty = Math.max(1, Math.min(qty + delta, currentProduct.stock || 999));
      document.getElementById('qty').textContent = qty;
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ==========================================
    // ADICIONAR AO CARRINHO - CORRIGIDO
    // ==========================================
    function addToCart() {
      if (!currentProduct || currentProduct.stock === 0) {
        showToast('âŒ Produto esgotado');
        return;
      }

      // Verificar se storage estÃ¡ disponÃ­vel
      if (typeof storage === 'undefined' || !storage.addToCart) {
        console.error('Storage nÃ£o carregado');
        showToast('âŒ Erro ao carregar sistema');
        return;
      }

      const size = document.querySelector('#sizeOptions .active')?.textContent || 'M';
      const color = document.querySelector('#colorOptions .active')?.textContent || 'Preto';
      
      // Criar objeto do produto para adicionar
      const productToAdd = {
        id: currentProduct.id,
        name: currentProduct.name,
        price: currentProduct.price,
        img: currentProduct.images[0],
        size: size,
        color: color,
        qty: qty
      };

      // Usar o mÃ©todo addToCart do storage
      const success = storage.addToCart(productToAdd, qty);
      
      if (success) {
        showToast(`âœ“ ${qty}x ${currentProduct.name} adicionado! (${size}, ${color})`);
        
        // Resetar quantidade
        qty = 1;
        document.getElementById('qty').textContent = qty;
      } else {
        showToast('âŒ Erro ao adicionar produto');
      }
    }

    function buyNow() {
      addToCart();
      setTimeout(() => {
        window.location.href = 'carrinho.html';
      }, 500);
    }

    // Expor funÃ§Ãµes globalmente
    window.changeImage = changeImage;
    window.selectOption = selectOption;
    window.updateQty = updateQty;
    window.addToCart = addToCart;
    window.buyNow = buyNow;
  </script>
</body>
</html>